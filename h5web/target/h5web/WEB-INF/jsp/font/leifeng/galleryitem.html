<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="applicable-device" content="mobile">
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>六合论坛</title>
    <base href="">
    <link rel="stylesheet" type="text/css" href="assets/css/reset.css">
    <link rel="stylesheet" type="text/css" href="assets/css/model.css">
    <link rel="stylesheet" type="text/css" href="lib/layer/theme/default/layer.css">
    <link rel="stylesheet" type="text/css" href="assets/css/layout.css">
    <script type="text/javascript">
        var baseUrl = "";
        var rserver = "http://formu-frontendweb.dj789.net/";
    </script>
    <script src="lib/require.js" type="text/javascript"></script>
    <script src="require.config.js" type="text/javascript"></script>
</head>

<body>
    <div id="wrapper" class="wrapper">
		<div class="content">
            <div id="header" class="__html_module" data-tmpl="module/header.html"></div>
            <div id="category-item">
                <div class="drawid-list">
                    <div class="drawid-title">
                        <h3>期号列表：</h3>
                        <ul id="drawid-list-ul"></ul>
                    </div>                    
                    <div id="category-img"></div>
                </div>
            </div>
        </div>
		<div id="footer" class="__html_module" data-tmpl="module/footer.html"></div>
    </div>
    <script id="drawIdTmpl" type="text/x-jquery-tmpl">
        <li><a href="javascript:void(0)" data-drawid="${$data}"><span>${$data}</span></a></li>
    </script>
    <script type="text/javascript">
        var paperid = 0;
        var reg = new RegExp("(^|&)id=([^&]*)(&|$)", "i"); 
        var r = window.location.search.substr(1).match(reg); 
        if (r != null) paperid = isNaN(parseInt(unescape(r[2])))?0:parseInt(unescape(r[2]));
        var drawlist = [];
        var pictureList = [];
        if(paperid>0){
            require(['jquery','tmpl','lib/jquery.tmpl.ext'],function($){
                var tmplExtFun = {                   
                };           
                var extFun = $.extend({},commonFunction,tmplExtFun);
                function resetDrawImgHtml(firstCategoryImgItem){
                    var imgItem = '<div class="img">';
                    imgItem += '<h2>'+firstCategoryImgItem.papers_name+'</h2>';
                    imgItem += '<a href="javascript:void(0)">';
                    if(firstCategoryImgItem.picture_a_url){
                        imgItem+='<img src="'+firstCategoryImgItem.picture_a_url+'" alt="" />';
                    }
                    if(firstCategoryImgItem.picture_b_url){
                        imgItem+='<img src="'+firstCategoryImgItem.picture_b_url+'" alt="" />';
                    }
                    if(firstCategoryImgItem.picture_c_url){
                        imgItem+='<img src="'+firstCategoryImgItem.picture_c_url+'" alt="" />';
                    }
                    if(firstCategoryImgItem.picture_d_url){
                        imgItem+='<img src="'+firstCategoryImgItem.picture_d_url+'" alt="" />';
                    }                            
                    imgItem+='</a>';
                    imgItem+='<h3>'+firstCategoryImgItem.draw_id+'</h3>';
                    imgItem+='</div>';
                    $("#category-img").html(imgItem);
                }
                function getCategoryList(reqOptions){
                    var reqData = reqOptions?reqOptions:{};
                    $.ajax({
                        url:rserver+"paper/picture/item",
                        data:reqData,
                        dataType:"jsonp",
                        success:function(respData, textStatus, jqXHR){
                            var categoryItemDrawIdStr = respData.category;
                            var categoryItemDrawIdList = categoryItemDrawIdStr.split(",");
                            drawlist = categoryItemDrawIdList;
                            pictureList =respData.list;
                            $("#drawIdTmpl").tmpl(categoryItemDrawIdList,extFun).appendTo("#drawid-list-ul");
                            var firstCategoryImgItem = respData.list[0];
                            //console.log(pictureList);
                            resetDrawImgHtml(firstCategoryImgItem);
                        },
                        error:function(XMLHttpRequest, textStatus, errorThrown){},
                        complete:function(XMLHttpRequest, textStatus){}
                    });
                }
                $(document).ready(function(){
                    getCategoryList({id:paperid});
                    $("#drawid-list-ul").on("click","a",function(event){
                        var drawid = $(this).data("drawid");
                        var drawItem = null;
                        for(var i=0;i<pictureList.length;i++){
                            var tmpDrawItem = pictureList[i];
                            if(tmpDrawItem.draw_id==drawid){
                                drawItem = tmpDrawItem;
                                break;
                            }
                        }
                        if(drawItem!=null){
                            resetDrawImgHtml(drawItem);
                        }
                    });       
                });
            });
        }
        
    </script>    
</body>
</html>